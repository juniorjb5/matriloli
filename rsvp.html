

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Confirmación de asistencia — O&O</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="css/normalize.css" rel="stylesheet" />
  <link href="css/webflow.css" rel="stylesheet" />
  <link href="css/andreina-felipe.webflow.css" rel="stylesheet" />
  <style>
    /* mini estilos locales para el gate */
    .gate-card{
      max-width: 560px; margin: 8vh auto 4vh; padding: 28px 24px;
      background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.08); text-align:center;
    }
    .gate-input{
      width:100%; border:none; border-bottom:1px solid var(--cafe); background:transparent;
      padding:10px 6px; color:var(--cafe); font-family:"The Youngest Serif Display", serif; font-size:18px;
    }
    .hint{ color:#8e8a7c; font-family:"Cormorant Garamond", serif; font-size:14px; margin:6px 0 0;}
    .err{ color:#9b3b3b; margin-top:10px; font-size:14px; font-family:"Cormorant Garamond", serif;}
    .rsvp-wrap{ max-width:720px; margin: 5vh auto 10vh; }
    .person{ position:relative; background:#fff; border:1px solid rgba(0,0,0,.12); border-radius:10px; padding:16px; }
.person legend{
  display:block;             /* el nombre entra al flujo de la caja */
  position:relative;
  background:#fff;           /* tapa el borde detrás */
  margin:0 0 8px;
  padding:0 6px;
  font-family:"The Youngest Serif Display",serif;
  color:var(--cafe); font-size:16px;
}

    .person label{ margin-right:14px; font-family:"Cormorant Garamond", serif; color:var(--cafe); }
    .note{ width:100%; min-height:90px; border:1px solid rgba(0,0,0,.12); border-radius:10px; padding:10px; font-family:"Cormorant Garamond", serif; }
  </style>
</head>



<body>
  
  
  
  
  
 <!-- DETECTOR NETLIFY (arriba del todo, oculto) -->
<form name="rsvp" data-netlify="true" netlify-honeypot="bot-field" action="/gracias/" hidden>
  <input type="hidden" name="form-name" value="rsvp">
  <!-- 1º campo = título que mostrará Netlify -->
  <input type="text"   name="subject">
  <input type="text"   name="name">
  <input type="text"   name="codigo">
  <textarea name="comentarios"></textarea>
  <!-- JSON con todos los invitados -->
  <textarea name="asistentes"></textarea>
  <!-- Placeholders para que el dashboard muestre columnas -->
  <input type="text" name="asiste_0">
  <input type="text" name="asiste_1">
  <input type="text" name="asiste_2">
  <input type="text" name="asiste_3">
  <input type="text" name="asiste_4">
  <input type="text" name="asiste_5">
  <input type="text" name="asiste_6">
  <input type="text" name="asiste_7">
  <input type="text" name="asiste_8">
  <input type="text" name="asiste_9">
</form>
 
  
  
  
  
  
  
  
  
  
  
  
  

<section class="section _5">
  <div class="container _3">
    <h1 class="heading _2-copy">Confirmación de asistencia</h1>
    <p class="paragraph-2 _1">Ingresa el <strong>código</strong> de tu invitación para continuar.</p>

    <!-- GATE -->
    <div id="gate" class="gate-card">
      <input id="codigoInput" class="gate-input" placeholder="Ej: ABC-26" autocomplete="one-time-code" />
      <p class="hint">El código está impreso en tu invitación.</p>
      <a id="validarBtn" class="w-button cta-button" style="margin-top:16px; display:inline-block; cursor:pointer;" role="button">Validar código</a>
      <div id="msg" class="err" role="alert" aria-live="polite"></div>
    </div>

    <!-- FORM RSVP (Netlify Forms) -->
    <div id="formBox" class="rsvp-wrap" style="display:none;">
      <form id="rsvpForm" name="rsvp" method="POST" action="/gracias/">
  <input type="hidden" name="form-name" value="rsvp">
  <input type="hidden" name="subject" id="subjectField">
  <input type="hidden" name="name"    id="titleField">
  <input type="hidden" name="codigo"  id="codigoHidden">
  <p style="display:none"><label>No completar: <input name="bot-field"></label></p>
  
  
  
  

<!-- Código de invitación -->
  

  <h2 class="heading _2-copy" id="titulo">Invitación</h2>
  <div id="personas"></div>

  <label class="field-label-4">¿Alguno de los asistentes tiene alguna restricción alimentaria? Dejanos un mensaje</label>
  <textarea class="note" name="comentarios" placeholder="Cuéntanos aquí"></textarea>

  <div class="div-block-72">
    <button type="submit" class="w-button cta-button">Enviar confirmación</button>
    <a href="/" class="confirm-alt">Volver al inicio</a>
  </div>
</form>



    </div>
  </div>
</section>


















<script>






// --- Ruta robusta para invitados.json ---
function invitadosPath(){
  // Si tu sitio está bajo /andreina/, pon el archivo en /andreina/invitados.json
  // y usa ruta relativa. Esto funciona tanto en raíz como en subcarpetas.
  return new URL('./invitados.json', window.location.href).href;
}



let invitadosCache = null;
async function loadInvitados(){
  if(!invitadosCache){
    const url = invitadosPath();
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error(`No se pudo cargar invitados.json (${res.status})`);
    invitadosCache = await res.json();
  }
  return invitadosCache;
}















function renderForm(codigo, registro){
  document.getElementById('gate').style.display = 'none';
  const box = document.getElementById('formBox'); box.style.display = 'block';

  document.getElementById('titulo').textContent = `Invitación ${codigo}`;
  document.getElementById('codigoHidden').value = codigo;

  // Forzar título en Netlify
  document.getElementById('subjectField').value = `Invitación ${codigo}`;
  document.getElementById('titleField').value   = `Invitación ${codigo}`;

  const cont = document.getElementById('personas');
  cont.innerHTML = '';
  (registro.nombres || []).forEach((nom, i)=>{
    const wrap = document.createElement('fieldset');
    wrap.className = 'person';
    wrap.innerHTML = `
      <legend>${nom}</legend>
      <label><input type="radio" name="asiste_${i}_radio" value="SI" required> Asiste</label>
      <label><input type="radio" name="asiste_${i}_radio" value="NO"> No asiste</label>
      <div class="person-error" aria-live="polite" style="display:none; color:#9b3b3b; margin-top:6px; font-family:'Cormorant Garamond', serif;">
        Debes seleccionar una opción.
      </div>
    `;
    cont.appendChild(wrap);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('rsvpForm');
  form.setAttribute('action', new URL('./gracias/', location.href).pathname);
  if(!form) return;





  form.addEventListener('submit', (e) => {
    // Validación visual
    let firstMissing = null;
    document.querySelectorAll('#personas fieldset.person').forEach((fs) => {
      const checked = fs.querySelector('input[type="radio"]:checked');
      const err = fs.querySelector('.person-error');
      if(!checked){ if(err) err.style.display = 'block'; if(!firstMissing) firstMissing = fs; }
      else{ if(err) err.style.display = 'none'; }
    });
    if(firstMissing){
      e.preventDefault();
      firstMissing.scrollIntoView({behavior:'smooth', block:'center'});
      return;
    }

    // Elimina sintéticos previos
    form.querySelectorAll('.synth-field').forEach(n => n.remove());

    // 1) columnas asiste_i (para que salgan en el dashboard)
    // 2) JSON "asistentes" (fuente de la verdad)
    const asistentes = [];
    
    
    document.querySelectorAll('#personas fieldset.person').forEach((fs, i) => {
      const nombre = (fs.querySelector('legend')?.textContent || `Invitado ${i+1}`).trim();
      const marcado = fs.querySelector('input[type="radio"]:checked');
      const asiste = marcado ? marcado.value : 'NO';

      const h = document.createElement('input');
      h.type = 'hidden';
      h.name = `asiste_${i}`;
      h.value = `${nombre}|${asiste}`;
      h.className = 'synth-field';
      form.appendChild(h);

      asistentes.push({ nombre, asiste });
    });

    const jsonField = document.createElement('textarea');
    jsonField.name = 'asistentes';
    jsonField.className = 'synth-field';
    jsonField.style.display = 'none';
    jsonField.value = JSON.stringify(asistentes);
    form.appendChild(jsonField);
  });
});














document.getElementById('validarBtn').addEventListener('click', async (ev)=>{
  ev.preventDefault(); // por si es <a>
  const msgEl = document.getElementById('msg'); 
  msgEl.textContent = '';

  const codeInput = document.getElementById('codigoInput');
  const code = codeInput.value.trim().toUpperCase();
  if(!code){ msgEl.textContent = 'Por favor, ingresa tu código.'; return; }

  try{
    const data = await loadInvitados();
    const registro = data[code];
    if(!registro){ msgEl.textContent = 'Código no válido. Revisa tu invitación o escríbenos.'; return; }
    renderForm(code, registro);
  }catch(err){
    console.error(err);
    msgEl.textContent = 'No pudimos cargar la lista de invitados. Revisa que el archivo “invitados.json” esté publicado en la misma carpeta de esta página o ajusta la ruta.';
  }
});

// Enter para validar
document.getElementById('codigoInput').addEventListener('keydown', e=>{
  if(e.key === 'Enter'){ e.preventDefault(); document.getElementById('validarBtn').click(); }
});



</script>












</body>


</html>
